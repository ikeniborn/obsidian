# =============================================================================
# Obsidian Sync Server Environment Configuration
# =============================================================================
# This file is a template for /opt/notes/.env
# Copy this file to /opt/notes/.env and configure values
# (or run notes/setup.sh to generate automatically)
#
# Supports two sync backends:
# - CouchDB: Client-Server (HTTP REST API, database storage)
# - ServerPeer: P2P (WebSocket relay, file-based vault storage)

# =============================================================================
# CouchDB Credentials
# =============================================================================

# CouchDB admin user (default: admin)
COUCHDB_USER=admin

# CouchDB admin password
# SECURITY: Generate strong password with: openssl rand -hex 32
# This password is used for:
# - CouchDB admin login
# - Obsidian remote sync plugin authentication
COUCHDB_PASSWORD=changeme_generate_with_setup_script

# =============================================================================
# Notes Domain Configuration
# =============================================================================

# Subdomain for notes access (через nginx reverse proxy)
# Development: notes.localhost
# Production: notes.yourdomain.com
NOTES_DOMAIN=notes.localhost

# =============================================================================
# SSL/TLS Configuration (Let's Encrypt)
# =============================================================================

# Email для уведомлений Let's Encrypt (обязательно для production)
# Используется для:
# - Уведомлений об истечении срока действия сертификата
# - Критичных обновлений безопасности
CERTBOT_EMAIL=admin@example.com

# Использовать Let's Encrypt staging (для тестов, избегая rate limits)
# true  - staging server (тестовые сертификаты, не доверяются браузерами)
# false - production server (настоящие сертификаты)
# Рекомендация: используйте staging для первого тестирования
CERTBOT_STAGING=false

# =============================================================================
# Sync Backend Configuration
# =============================================================================

# Sync backend type: couchdb or serverpeer
# - couchdb:    Client-Server architecture (HTTP REST API, database storage)
#               Traditional CouchDB deployment with replication protocol
# - serverpeer: P2P architecture (WebSocket relay, file-based vault)
#               Headless vault with peer-to-peer synchronization
#
# Set during setup.sh via interactive selection
# Default: couchdb
SYNC_BACKEND=couchdb

# =============================================================================
# ServerPeer Configuration (only used when SYNC_BACKEND=serverpeer)
# =============================================================================

# Application ID for livesync-serverpeer
# Default: self-hosted-livesync
# This identifies your sync application instance
#SERVERPEER_APPID=self-hosted-livesync

# Room ID (unique identifier for sync room)
# Auto-generated during setup.sh using: openssl rand -hex 6
# Format: xx-xx-xx-xx-xx-xx (12 hex chars with dashes)
# SECURITY: Keep this secret - it identifies your sync room
#SERVERPEER_ROOMID=auto-generated-during-setup

# Passphrase for end-to-end encryption
# Auto-generated during setup.sh using: openssl rand -hex 16
# Format: 32 hex characters (128-bit security)
# SECURITY: Keep this secret - used for encrypting sync data
#SERVERPEER_PASSPHRASE=auto-generated-during-setup

# WebSocket relay servers (comma-separated list)
# Default: wss://exp-relay.vrtmrz.net/ (experimental relay by vrtmrz)
# Can be self-hosted or public relays
#SERVERPEER_RELAYS=wss://exp-relay.vrtmrz.net/

# Peer name (displayed in sync status)
# Default: ${NOTES_DOMAIN}-peer
#SERVERPEER_NAME=notes.example.com-peer

# Vault name for headless vault
# Default: headless-vault
#SERVERPEER_VAULT_NAME=headless-vault

# Auto-broadcast changes to peers (true/false)
# Default: true
#SERVERPEER_AUTOBROADCAST=true

# Auto-start sync on container launch (true/false)
# Default: true
#SERVERPEER_AUTOSTART=true

# ServerPeer container port (localhost only)
# Default: 3000
#SERVERPEER_PORT=3000

# Vault directory (persistent storage for headless vault)
# Default: /opt/notes/serverpeer-vault
#SERVERPEER_VAULT_DIR=/opt/notes/serverpeer-vault

# ServerPeer container name
# Default: notes-serverpeer
#SERVERPEER_CONTAINER_NAME=notes-serverpeer

# =============================================================================
# Data Directories
# =============================================================================

# CouchDB data directory (persistent storage)
NOTES_DATA_DIR=/opt/notes/data

# Backups directory (для couchdb-backup.sh)
NOTES_BACKUP_DIR=/opt/notes/backups

# Logs directory
NOTES_LOG_DIR=/opt/notes/logs

# =============================================================================
# Network Configuration
# =============================================================================

# Network mode: shared, isolated
# - shared: use existing Docker network from another service
# - isolated: create new dedicated network with auto subnet selection
# Configured during setup.sh via interactive selection
#NETWORK_MODE=shared

# Network name (detected or created during setup)
# Examples:
# - Existing network: my_app_network, webproxy_default, etc.
# - New isolated: obsidian_network
#NETWORK_NAME=obsidian_network

# Is network external (managed outside this docker-compose)?
# true - network exists externally (created by another docker-compose or manually)
# false - network managed by this docker-compose
#NETWORK_EXTERNAL=true

# Custom subnet for isolated mode (auto-selected if not specified)
# Format: 172.X.0.0/16 (where X is 24-31)
# Only used when NETWORK_MODE=isolated
#NETWORK_SUBNET=172.25.0.0/16

# =============================================================================
# Container Configuration
# =============================================================================

# CouchDB container name (default: notes-couchdb)
# Change if you have naming conflicts or conventions
COUCHDB_CONTAINER_NAME=notes-couchdb

# CouchDB port (bound to localhost only, access through nginx)
COUCHDB_PORT=5984

# =============================================================================
# Nginx Configuration
# =============================================================================

# Nginx container name (if using existing nginx)
# Set during setup.sh based on selection
# Examples: nginx, webproxy, reverse-proxy, notes-nginx (own)
#NGINX_CONTAINER_NAME=notes-nginx

# Nginx config directory (where to place notes.conf)
# Auto-detected during setup or specified manually
# Examples:
# - Docker nginx volume: /opt/nginx/conf.d
# - Systemd nginx: /etc/nginx/sites-available or /etc/nginx/conf.d
#NGINX_CONFIG_DIR=/etc/nginx/conf.d

# Deploy own nginx container (true/false)
# true - deploy dedicated nginx container for notes
# false - use existing nginx (systemd or docker)
#DEPLOY_OWN_NGINX=false

# =============================================================================
# S3 Backup Configuration (Optional)
# =============================================================================

# S3-compatible storage credentials
# Поддерживаются: AWS S3, Yandex Object Storage, MinIO, DigitalOcean Spaces, etc.
# Оставьте пустым если не используете S3 backups (backups будут только локальные)

S3_ACCESS_KEY_ID=your_access_key
S3_SECRET_ACCESS_KEY=your_secret_key
S3_BUCKET_NAME=obsidian-backups

# S3 Endpoint URL (зависит от провайдера):
# - Yandex Object Storage:     https://storage.yandexcloud.net
# - AWS S3 (us-east-1):         https://s3.amazonaws.com
# - AWS S3 (eu-central-1):      https://s3.eu-central-1.amazonaws.com
# - MinIO (self-hosted):        https://minio.yourdomain.com
# - DigitalOcean Spaces (NYC3): https://nyc3.digitaloceanspaces.com
S3_ENDPOINT_URL=https://storage.yandexcloud.net

# S3 Region (зависит от провайдера):
# - Yandex Object Storage:      ru-central1
# - AWS S3:                     us-east-1, eu-central-1, etc.
# - MinIO:                      us-east-1 (обычно default)
# - DigitalOcean Spaces:        nyc3, fra1, sgp1, etc.
S3_REGION=ru-central1

# S3 backup prefix (папка в bucket для организации backups)
# Automatically set based on SYNC_BACKEND during setup.sh:
# - couchdb:    couchdb-backups/
# - serverpeer: serverpeer-backups/
# Примеры: couchdb-backups/production/
#          serverpeer-backups/production/
#          backups/notes/
S3_BACKUP_PREFIX=couchdb-backups/

# =============================================================================
# Notes
# =============================================================================
# - NEVER commit this file with real credentials
# - /opt/notes/.env is created by notes/setup.sh automatically
# - CouchDB accessible at: http://NOTES_DOMAIN (through nginx)
#
# S3 Configuration Examples:
#
# Yandex Object Storage:
#   S3_ENDPOINT_URL=https://storage.yandexcloud.net
#   S3_REGION=ru-central1
#
# AWS S3:
#   S3_ENDPOINT_URL=https://s3.eu-central-1.amazonaws.com
#   S3_REGION=eu-central-1
#
# MinIO (self-hosted):
#   S3_ENDPOINT_URL=https://minio.yourdomain.com
#   S3_REGION=us-east-1
