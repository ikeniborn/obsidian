[couchdb]
single_node=true
max_document_size = 50000000
; Priority 2: Optimize write performance (3-5x faster bulk writes)
delayed_commits = true
file_compression = snappy
; Priority 4: Query optimization (applied conservatively)
max_dbs_open = 1000
attachment_compression_level = 6

[chttpd]
require_valid_user = true
; Priority 3: Reduce from 4 GB to 100 MB (2x max_document_size for safety)
max_http_request_size = 104857600
; Priority 3: Connection limits to prevent resource exhaustion
max_connections = 200

[chttpd_auth]
require_valid_user = true
authentication_redirect = /_utils/session.html

[httpd]
WWW-Authenticate = Basic realm="couchdb"
enable_cors = true
; Priority 5: Enable gzip compression for HTTP responses
compression = true

[cors]
origins = app://obsidian.md,capacitor://localhost,http://localhost
credentials = true
headers = accept, authorization, content-type, origin, referer
methods = GET, PUT, POST, HEAD, DELETE
max_age = 3600

; Priority 1: CRITICAL - Automatic compaction to prevent database bloat
[compaction_daemon]
; Check for compaction need every 5 minutes
check_interval = 300
; Only consider compaction for databases > 50 MB
min_file_size = 52428800
; Allow compaction anytime (not restricted to night hours)
strict_window = false

[compactions]
; Compact when fragmentation exceeds 20%
_default = [{db_fragmentation, "20%"}, {view_fragmentation, "20%"}]

; Priority 4: Query server optimization
[query_server_config]
; Increase timeout for complex views (10 seconds)
os_process_timeout = 10000
; Max 50 concurrent external processes
os_process_soft_limit = 50

; Priority 7: Logging and monitoring
[log]
; Log only warnings and above (reduce noise)
level = warning
writer = stderr

[stats]
; Collect statistics every 10 seconds
interval = 10